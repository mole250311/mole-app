CREATE TABLE users (
    user_id           INT AUTO_INCREMENT PRIMARY KEY,          -- 고유 사용자 ID
    username          VARCHAR(30)  NOT NULL UNIQUE,            -- 로그인 ID
    password          VARCHAR(255) NOT NULL,                   -- 해시된 비밀번호
    email             VARCHAR(100) NOT NULL UNIQUE,            -- 이메일
    phone_number      VARCHAR(20)  NOT NULL UNIQUE,            -- 전화번호
    birth_date        DATE,                                    -- 생년월일
    school_name       VARCHAR(100),                            -- 학교명
    department_name   VARCHAR(100),                            -- 학과명
    created_at        DATETIME DEFAULT CURRENT_TIMESTAMP       -- 가입일시
);
CREATE TABLE user_profiles (
    user_id           INT PRIMARY KEY,                         -- users.user_id 참조
    username          VARCHAR(30) NOT NULL,                    -- 조회용
    student_id        VARCHAR(20) NOT NULL UNIQUE,             -- 학번
    school_name       VARCHAR(100),
    department_name   VARCHAR(100),
    last_chapter_id   INT,                                     -- 최종 종료 챕터 ID
    last_page_number  INT,                                     -- 최종 종료 페이지 번호
    updated_at        DATETIME DEFAULT CURRENT_TIMESTAMP
                         ON UPDATE CURRENT_TIMESTAMP,          -- 최근 갱신 시각

    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);
CREATE TABLE user_favorites (
    id             INT AUTO_INCREMENT PRIMARY KEY,
    user_id        INT NOT NULL,
    chapter_id     INT NOT NULL,            -- 즐겨찾기한 챕터
    page_number    INT,                     -- 즐겨찾기한 페이지 (선택)
    created_at     DATETIME DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE,

    UNIQUE(user_id, chapter_id, page_number)  -- 중복 즐겨찾기 방지
);
